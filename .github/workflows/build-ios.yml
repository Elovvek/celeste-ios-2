name: Build Celeste iOS App

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install Mono (official PKG)
        run: |
          curl -LO https://download.mono-project.com/archive/6.12.0/macos-10-universal/MonoFramework-MDK-6.12.0.122.macos10.xamarin.universal.pkg
          sudo installer -pkg MonoFramework-MDK-6.12.0.122.macos10.xamarin.universal.pkg -target /

      - name: Check Mono version
        run: mono --version

      - name: Install NuGet CLI
        run: |
          curl -LO https://dist.nuget.org/win-x86-commandline/latest/nuget.exe

      - name: Restore NuGet packages
        run: |
          mono nuget.exe restore celestemeow.sln

      - name: Build with msbuild (Mono)
        run: |
          /Library/Frameworks/Mono.framework/Commands/msbuild celestemeow.sln /p:Configuration=Release /p:Platform=iPhone

      - name: Package IPA (adjust paths as needed)
        run: |
          mkdir -p output
          cp -r path/to/build/output/*.ipa output/

      - name: Upload IPA artifact
        uses: actions/upload-artifact@v3
        with:
          name: Celeste-iOS-IPA
          path: output/*.ipa
