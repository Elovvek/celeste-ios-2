name: Build Celeste iOS

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  build-ios:
    runs-on: macos-latest

    steps:
    - name: Checkout repo with submodules
      uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Install .NET 8 SDK
      run: |
        brew install --cask dotnet-sdk
        dotnet --version

    - name: Install .NET MAUI workloads (including iOS)
      run: |
        dotnet workload install maui-ios

    - name: Restore .NET dependencies
      run: dotnet restore celestemeow.sln

    - name: Build iOS project
      run: |
        dotnet build celestemeow.sln \
          -c Release \
          -p:Platform=iPhone \
          -p:BuildIpa=true \
          -p:IpaPackageDir=$(pwd)/output

    - name: Upload IPA artifact
      uses: actions/upload-artifact@v4
      with:
        name: celeste-ios-ipa
        path: output/*.ipa
